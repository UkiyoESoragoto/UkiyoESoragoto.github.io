<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>What is a NullReferenceException, and how do I fix it? | 非量子化异次元平行时空奇点对侧的不可视境界线</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="所谓灵魂 几行代码">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.56fa1c2d.css" as="style"><link rel="preload" href="/assets/js/app.68e77b21.js" as="script"><link rel="preload" href="/assets/js/3.fe1004ba.js" as="script"><link rel="preload" href="/assets/js/1.dbbc696f.js" as="script"><link rel="preload" href="/assets/js/25.b81b40e7.js" as="script"><link rel="preload" href="/assets/js/8.9bd2c16f.js" as="script"><link rel="prefetch" href="/assets/js/10.474ae456.js"><link rel="prefetch" href="/assets/js/11.165a010e.js"><link rel="prefetch" href="/assets/js/12.499a7aaa.js"><link rel="prefetch" href="/assets/js/13.466c812d.js"><link rel="prefetch" href="/assets/js/14.b533c573.js"><link rel="prefetch" href="/assets/js/15.7b81819d.js"><link rel="prefetch" href="/assets/js/16.2e75c68f.js"><link rel="prefetch" href="/assets/js/17.28dd5497.js"><link rel="prefetch" href="/assets/js/18.97786fea.js"><link rel="prefetch" href="/assets/js/19.7ac20f8b.js"><link rel="prefetch" href="/assets/js/20.b68980f8.js"><link rel="prefetch" href="/assets/js/21.92a76789.js"><link rel="prefetch" href="/assets/js/22.ad81384d.js"><link rel="prefetch" href="/assets/js/23.b07a4ffa.js"><link rel="prefetch" href="/assets/js/24.927119ab.js"><link rel="prefetch" href="/assets/js/26.47a53ef2.js"><link rel="prefetch" href="/assets/js/27.3c0021d3.js"><link rel="prefetch" href="/assets/js/28.f8839ab3.js"><link rel="prefetch" href="/assets/js/29.53559567.js"><link rel="prefetch" href="/assets/js/4.d5324994.js"><link rel="prefetch" href="/assets/js/5.26491be7.js"><link rel="prefetch" href="/assets/js/6.ec7811c8.js"><link rel="prefetch" href="/assets/js/7.80d9aec8.js"><link rel="prefetch" href="/assets/js/9.0f4ae6b2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56fa1c2d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>非量子化异次元平行时空奇点对侧的不可视境界线</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>浮世絵空事</span>
            
          <span data-v-64685f0e>2015 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.jpg" alt="非量子化异次元平行时空奇点对侧的不可视境界线" class="logo"> <span class="site-name">非量子化异次元平行时空奇点对侧的不可视境界线</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Project/" class="nav-link"><i class="iconfont undefined"></i>
  Project
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tech/" class="nav-link"><i class="iconfont undefined"></i>
  Tech
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      About
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/me/" class="nav-link"><i class="iconfont undefined"></i>
  Me
</a></li><li class="dropdown-item"><!----> <a href="/about/thanks/" class="nav-link"><i class="iconfont undefined"></i>
  Thanks
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/ukiyoesoragoto" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    浮世絵空事
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>16</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>19</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Project/" class="nav-link"><i class="iconfont undefined"></i>
  Project
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tech/" class="nav-link"><i class="iconfont undefined"></i>
  Tech
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      About
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/me/" class="nav-link"><i class="iconfont undefined"></i>
  Me
</a></li><li class="dropdown-item"><!----> <a href="/about/thanks/" class="nav-link"><i class="iconfont undefined"></i>
  Thanks
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/ukiyoesoragoto" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>What is a NullReferenceException, and how do I fix it?</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>浮世絵空事</span>
            
          <span data-v-64685f0e>2015 - </span>
          2021
        </a></span></div></div> <div data-v-2d5f533b><main class="page" style="padding-right:0;"><div class="page-title" style="display:none;"><h1 class="title">What is a NullReferenceException, and how do I fix it?</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>浮世絵空事</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2017-04-07 15:49:00</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>C#</span><span class="tag-item" data-v-3b7f5bdf>.Net</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>Copy from: http://stackoverflow.com/a/4660186/4190277</p> <h3 id="what-is-the-cause"><a href="#what-is-the-cause" class="header-anchor">#</a> What is the cause?</h3> <h4 id="bottom-line"><a href="#bottom-line" class="header-anchor">#</a> Bottom Line</h4> <p>You are trying to use something that is <code>null</code> (or <code>Nothing</code> in VB.NET). This means you either set it to <code>null</code>, or you never set it to anything at all.</p> <p>Like anything else, <code>null</code> gets passed around. If it is <code>null</code> <em>in</em> method &quot;A&quot;, it could be that method &quot;B&quot; passed a <code>null</code> <em>to</em> method &quot;A&quot;.</p> <p>The rest of this article goes into more detail and shows mistakes that many programmers often make which can lead to a <code>NullReferenceException</code>.</p> <h4 id="more-specifically"><a href="#more-specifically" class="header-anchor">#</a> More Specifically</h4> <p>The runtime throwing a <code>NullReferenceException</code> <strong>always</strong> means the same thing: you are trying to use a reference. The reference is not initialized (or it was <em>once</em> initialized, but is no <em>longer</em> initialized).</p> <p>This means the reference is <code>null</code>, and you cannot access members through a <code>null</code> reference. The simplest case:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>string foo <span class="token operator">=</span> null<span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This will throw a <code>NullReferenceException</code> at the second line, because you can't call the instance method <code>ToUpper()</code> on a <code>string</code> reference pointing to <code>null</code>.</p> <h3 id="debugging"><a href="#debugging" class="header-anchor">#</a> Debugging</h3> <p>How do you find the source of a <code>NullReferenceException</code>? Apart from looking at the exception itself, which will be thrown exactly at the location where it occurs, the general rules of debugging in Visual Studio apply: place strategic breakpoints and <a href="http://msdn.microsoft.com/en-us/library/esta7c62.aspx" target="_blank" rel="noopener noreferrer">inspect your variables<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, either by hovering the mouse over their names, opening a (Quick)Watch window or using the various debugging panels like Locals and Autos.</p> <p>If you want to find out where the reference is or isn't set, right-click its name and select &quot;Find All References&quot;. You can then place a breakpoint at every found location and run your program with the debugger attached. Every time the debugger breaks on such a breakpoint, you need to determine whether you expect the reference to be non-null, inspect the variable and and verify that it points to an instance when you expect it to.</p> <p>By following the program flow this way you can find the location where the instance should not be null, and why it isn't properly set.</p> <h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <p>Some common scenarios where the exception can be thrown:</p> <h4 id="generic"><a href="#generic" class="header-anchor">#</a> Generic</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>ref1<span class="token punctuation">.</span>ref2<span class="token punctuation">.</span>ref3<span class="token punctuation">.</span>member
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If ref1 or ref2 or ref3 is null, then you'll get a <code>NullReferenceException</code>. If you want to solve the problem, then find out which one is null by rewriting the expression to its simpler equivalent:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>var r1 <span class="token operator">=</span> ref1<span class="token punctuation">;</span>
var r2 <span class="token operator">=</span> r1<span class="token punctuation">.</span>ref2<span class="token punctuation">;</span>
var r3 <span class="token operator">=</span> r2<span class="token punctuation">.</span>ref3<span class="token punctuation">;</span>
r3<span class="token punctuation">.</span>member
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Specifically, in <code>HttpContext.Current.User.Identity.Name</code>, the <code>HttpContext.Current</code> could be null, or the <code>User</code> property could be null, or the <code>Identity</code> property could be null.</p> <h4 id="class-instances"><a href="#class-instances" class="header-anchor">#</a> Class instances</h4> <p>When creating a variable of a reference (class) type it is by default set to <code>null</code>.</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>public class Book <span class="token punctuation">{</span>
    public string Title <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
public class Example <span class="token punctuation">{</span>
    public <span class="token keyword">void</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Book b1<span class="token punctuation">;</span>
        string title <span class="token operator">=</span> b1<span class="token punctuation">.</span>Title<span class="token punctuation">;</span> <span class="token comment">// You never initialized the b1 variable.</span>
                                    <span class="token comment">// there is no book to get the title from.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Class type variables must either be initialized or set to an already existing class instance. Initialization is done by using the <code>new</code> keyword.</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>Book b1 <span class="token operator">=</span> new <span class="token function">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="indirect"><a href="#indirect" class="header-anchor">#</a> Indirect</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>public class Person <span class="token punctuation">{</span>
    public <span class="token keyword">int</span> Age <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
public class Book <span class="token punctuation">{</span>
    public Person Author <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
public class Example <span class="token punctuation">{</span>
    public <span class="token keyword">void</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Book b1 <span class="token operator">=</span> new <span class="token function">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> authorAge <span class="token operator">=</span> b1<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>Age<span class="token punctuation">;</span> <span class="token comment">// You never initialized the Author property.</span>
                                        <span class="token comment">// there is no Person to get an Age from.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>If you want to avoid the child (Person) null reference you could initialize it in the parent (Book) object's constructor.</p> <p>The same applies to nested object initializers:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>Book b1 <span class="token operator">=</span> new Book <span class="token punctuation">{</span> Author <span class="token operator">=</span> <span class="token punctuation">{</span> Age <span class="token operator">=</span> <span class="token number">45</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>While the <code>new</code> keyword is used, it only creates a new instance of <code>Book</code>, but not a new instance of <code>Person</code>, so the <code>Author</code> the property is still <code>null</code>.</p> <h4 id="array"><a href="#array" class="header-anchor">#</a> Array</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numbers <span class="token operator">=</span> null<span class="token punctuation">;</span>
<span class="token keyword">int</span> n <span class="token operator">=</span> numbers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// numbers is null. There is no array to index.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="array-elements"><a href="#array-elements" class="header-anchor">#</a> Array Elements</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>Person<span class="token punctuation">[</span><span class="token punctuation">]</span> people <span class="token operator">=</span> new Person<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment">// people[0] is null. The array was allocated but not</span>
                   <span class="token comment">// initialized. There is no Person to set the Age for.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="jagged-arrays"><a href="#jagged-arrays" class="header-anchor">#</a> Jagged Arrays</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> new <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// is null because only the first dimension is yet initialized.</span>
                 <span class="token comment">// Use array[0] = new long[2]; first.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="collection-list-dictionary"><a href="#collection-list-dictionary" class="header-anchor">#</a> Collection/List/Dictionary</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>Dictionary<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> agesForNames <span class="token operator">=</span> null<span class="token punctuation">;</span>
<span class="token keyword">int</span> age <span class="token operator">=</span> agesForNames<span class="token punctuation">[</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// agesForNames is null.</span>
                               <span class="token comment">// There is no Dictionary to perform the lookup.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="range-variable-indirect-deferred"><a href="#range-variable-indirect-deferred" class="header-anchor">#</a> Range Variable (Indirect/Deferred)</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>public class Person <span class="token punctuation">{</span>
    public string Name <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
var people <span class="token operator">=</span> new List<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
people<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
var names <span class="token operator">=</span> from p in people select p<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
string firstName <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Exception is thrown here, but actually occurs</span>
                                  <span class="token comment">// on the line above.  &quot;p&quot; is null because the</span>
                                  <span class="token comment">// first element we added to the list is null.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="events"><a href="#events" class="header-anchor">#</a> Events</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>public class Demo
<span class="token punctuation">{</span>
    public event EventHandler StateChanged<span class="token punctuation">;</span>

    protected virtual <span class="token keyword">void</span> <span class="token function">OnStateChanged</span><span class="token punctuation">(</span>EventArgs e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>        
        <span class="token function">StateChanged</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Exception is thrown here </span>
                               <span class="token comment">// if no event handlers have been attached</span>
                               <span class="token comment">// to StateChanged event</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="bad-naming-conventions"><a href="#bad-naming-conventions" class="header-anchor">#</a> Bad Naming Conventions:</h4> <p>If you named fields differently from locals, you might have realized that you never initialized the field.</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>public class Form1 <span class="token punctuation">{</span>
    private Customer customer<span class="token punctuation">;</span>

    private <span class="token keyword">void</span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span>object sender<span class="token punctuation">,</span> EventArgs e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Customer customer <span class="token operator">=</span> new <span class="token function">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        customer<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    private <span class="token keyword">void</span> <span class="token function">Button_Click</span><span class="token punctuation">(</span>object sender<span class="token punctuation">,</span> EventArgs e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>customer<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>This can be solved by following the convention to prefix fields with an underscore:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>private Customer _customer<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="asp-net-page-life-cycle"><a href="#asp-net-page-life-cycle" class="header-anchor">#</a> ASP.NET Page Life cycle:</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>public partial class Issues_Edit <span class="token operator">:</span> System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>Page
<span class="token punctuation">{</span>
    protected TestIssue myIssue<span class="token punctuation">;</span>

    protected <span class="token keyword">void</span> <span class="token function">Page_Load</span><span class="token punctuation">(</span>object sender<span class="token punctuation">,</span> EventArgs e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>IsPostBack<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Only called on first load, not when button clicked</span>
            myIssue <span class="token operator">=</span> new <span class="token function">TestIssue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    protected <span class="token keyword">void</span> <span class="token function">SaveButton_Click</span><span class="token punctuation">(</span>object sender<span class="token punctuation">,</span> EventArgs e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        myIssue<span class="token punctuation">.</span>Entry <span class="token operator">=</span> <span class="token string">&quot;NullReferenceException here!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="asp-net-session-values"><a href="#asp-net-session-values" class="header-anchor">#</a> ASP.NET Session Values</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token comment">// if the &quot;FirstName&quot; session value has not yet been set,</span>
<span class="token comment">// then this line will throw a NullReferenceException</span>
string firstName <span class="token operator">=</span> Session<span class="token punctuation">[</span><span class="token string">&quot;FirstName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="asp-net-mvc-empty-view-models"><a href="#asp-net-mvc-empty-view-models" class="header-anchor">#</a> ASP.NET MVC empty view models</h4> <p>If the exception occurs when referencing a property of <code>@Model</code> in an ASP.NET MVC view, you need to understand that the <code>Model</code> gets set in your action method, when you <code>return</code> a view. When you return an empty model (or model property) from your controller, the exception occurs when the views accesses it:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token comment">// Controller</span>
public class Restaurant<span class="token operator">:</span>Controller
<span class="token punctuation">{</span>
    public ActionResult <span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Forgot the provide a Model here.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Razor view </span>
@<span class="token function">foreach</span> <span class="token punctuation">(</span>var restaurantSearch in Model<span class="token punctuation">.</span>RestaurantSearch<span class="token punctuation">)</span>  <span class="token comment">// Throws.</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>@Model<span class="token punctuation">.</span>somePropertyName<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Also throws <span class="token operator">--</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="wpf-control-creation-order-and-events"><a href="#wpf-control-creation-order-and-events" class="header-anchor">#</a> WPF Control Creation Order and Events</h4> <p>WPF controls are created during the call to <code>InitializeComponent</code> in the order they appear in the visual tree.  A <code>NullReferenceException</code> will be raised in the case of early-created controls with event handlers, etc, that fire during <code>InitializeComponent</code> which reference late-created controls.</p> <p>For example :</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Grid</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Combobox declared first --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComboBox</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboBox1<span class="token punctuation">&quot;</span></span> 
              <span class="token attr-name">Margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">SelectedIndex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> 
              <span class="token attr-name">SelectionChanged</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboBox1_SelectionChanged<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComboBoxItem</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Item 1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComboBoxItem</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Item 2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComboBoxItem</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Item 3<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ComboBox</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- Label declared later --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Label</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label1<span class="token punctuation">&quot;</span></span> 
            <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Label<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">Margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Grid</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Here <code>comboBox1</code> is created before <code>label1</code>. If <code>comboBox1_SelectionChanged</code> attempts to reference <code>label1</code> it will not yet have been created.</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>private <span class="token keyword">void</span> <span class="token function">comboBox1_SelectionChanged</span><span class="token punctuation">(</span>object sender<span class="token punctuation">,</span> SelectionChangedEventArgs e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    label1<span class="token punctuation">.</span>Content <span class="token operator">=</span> comboBox1<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NullReference here!!</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Changing the order of the declarations in the XAML (ie: listing <code>label1</code> before <code>comboBox1</code>, ignoring issues of design philosophy, would at least resolve the <code>NullReferenceException</code> here.</p> <h4 id="cast-with-as"><a href="#cast-with-as" class="header-anchor">#</a> Cast with <code>as</code></h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>var myThing <span class="token operator">=</span> someObject as Thing<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This doesn't throw an InvalidCastException, but returns a <code>null</code> when the cast fails (and when someObject is itself null). So be aware of that.</p> <h4 id="linq-firstordefault-and-singleordefault"><a href="#linq-firstordefault-and-singleordefault" class="header-anchor">#</a> LINQ FirstOrDefault() and SingleOrDefault()</h4> <p>The plain versions <code>First()</code> and <code>Single()</code> throw exceptions when there is nothing. The &quot;OrDefault&quot; versions return null in that case. So be aware of that.</p> <h4 id="foreach"><a href="#foreach" class="header-anchor">#</a> foreach</h4> <p><code>foreach</code> throws when you try to iterate null collection. Usually caused by unexpected <code>null</code> result from methods that return collections.</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>List<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> null<span class="token punctuation">;</span>    
<span class="token function">foreach</span><span class="token punctuation">(</span>var v in list<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">// exception</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>More realistic example- select nodes from XML document. Will throw if nodes are not found but initial debugging shows that all properties valid:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token function">foreach</span> <span class="token punctuation">(</span>var node in myData<span class="token punctuation">.</span>MyXml<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;//Data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <h3 id="ways-to-avoid"><a href="#ways-to-avoid" class="header-anchor">#</a> Ways to Avoid</h3> <h4 id="explicitly-check-for-null-and-ignore-null-values"><a href="#explicitly-check-for-null-and-ignore-null-values" class="header-anchor">#</a> Explicitly check for <code>null</code>, and ignore null values.</h4> <p>If you expect the reference sometimes to be null, you can check for it being <code>null</code> before accessing instance members:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">PrintName</span><span class="token punctuation">(</span>Person p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="explicitly-check-for-null-and-provide-a-default-value"><a href="#explicitly-check-for-null-and-provide-a-default-value" class="header-anchor">#</a> Explicitly check for <code>null</code>, and provide a default value.</h4> <p>Methods calls you expect to return an instance can return <code>null</code>, for example when the object being sought cannot be found. You can choose to return a default value when this is the case:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>string <span class="token function">GetCategory</span><span class="token punctuation">(</span>Book b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> null<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Unknown&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span>Category<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="explicitly-check-for-null-from-method-calls-and-throw-a-custom-exception"><a href="#explicitly-check-for-null-from-method-calls-and-throw-a-custom-exception" class="header-anchor">#</a> Explicitly check for <code>null</code> from method calls and throw a custom exception.</h4> <p>You can also throw a custom exception, only to catch it in the calling code:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>string <span class="token function">GetCategory</span><span class="token punctuation">(</span>string bookTitle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    var book <span class="token operator">=</span> library<span class="token punctuation">.</span><span class="token function">FindBook</span><span class="token punctuation">(</span>bookTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// This may return null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>book <span class="token operator">==</span> null<span class="token punctuation">)</span>
        throw new <span class="token function">BookNotFoundException</span><span class="token punctuation">(</span>bookTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Your custom exception</span>
    <span class="token keyword">return</span> book<span class="token punctuation">.</span>Category<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="use-debug-assert-if-a-value-should-never-be-null-to-catch-the-problem-earlier-than-the-exception-occurs"><a href="#use-debug-assert-if-a-value-should-never-be-null-to-catch-the-problem-earlier-than-the-exception-occurs" class="header-anchor">#</a> Use <code>Debug.Assert</code> if a value should never be <code>null</code>, to catch the problem earlier than the exception occurs.</h4> <p>When you know during development that a method maybe can, but actually never should return <code>null</code>, you can use <code>Debug.Assert()</code> to break as soon as possible when it does occur:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>string <span class="token function">GetTitle</span><span class="token punctuation">(</span><span class="token keyword">int</span> knownBookID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// You know this should never return null.</span>
    var book <span class="token operator">=</span> library<span class="token punctuation">.</span><span class="token function">GetBook</span><span class="token punctuation">(</span>knownBookID<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment">// Exception will occur on the next line instead of at the end of this method.</span>
    Debug<span class="token punctuation">.</span><span class="token function">Assert</span><span class="token punctuation">(</span>book <span class="token operator">!=</span> null<span class="token punctuation">,</span> <span class="token string">&quot;Library didn't return a book for known book ID.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Some other code ...</span>

    <span class="token keyword">return</span> book<span class="token punctuation">.</span>Title<span class="token punctuation">;</span> <span class="token comment">// Will never throw NullReferenceException in Debug mode.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Though this check <a href="http://stackoverflow.com/questions/3021538/debug-assert-appears-in-release-mode" target="_blank" rel="noopener noreferrer">will not end up in your release build<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, causing it to throw the <code>NullReferenceException</code> again when <code>book == null</code> at runtime in release mode.</p> <h4 id="use-getvalueordefault-for-nullable-value-types-to-provide-a-default-value-when-they-are-null"><a href="#use-getvalueordefault-for-nullable-value-types-to-provide-a-default-value-when-they-are-null" class="header-anchor">#</a> Use <code>GetValueOrDefault()</code> for nullable value types to provide a default value when they are <code>null</code>.</h4> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>DateTime<span class="token operator">?</span> appointment <span class="token operator">=</span> null<span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>appointment<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Will display the default value provided (DateTime.Now), because appointment is null.</span>

appointment <span class="token operator">=</span> new <span class="token function">DateTime</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>appointment<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Will display the appointment date, not the default</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="use-the-null-coalescing-operator-c-or-if-vb"><a href="#use-the-null-coalescing-operator-c-or-if-vb" class="header-anchor">#</a> Use the null coalescing operator: <code>??</code> [C#] or <code>If()</code> [VB].</h4> <p>The shorthand to providing a default value when a <code>null</code> is encountered:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>IService <span class="token function">CreateService</span><span class="token punctuation">(</span>ILogger log<span class="token punctuation">,</span> Int32<span class="token operator">?</span> frobPowerLevel<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    var serviceImpl <span class="token operator">=</span> new <span class="token function">MyService</span><span class="token punctuation">(</span>log <span class="token operator">?</span><span class="token operator">?</span> NullLog<span class="token punctuation">.</span>Instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Note that the above &quot;GetValueOrDefault()&quot; can also be rewritten to use</span>
    <span class="token comment">// the coalesce operator:</span>
    serviceImpl<span class="token punctuation">.</span>FrobPowerLevel <span class="token operator">=</span> frobPowerLevel <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="use-the-null-condition-operator-available-in-c-6-and-vb-net-14"><a href="#use-the-null-condition-operator-available-in-c-6-and-vb-net-14" class="header-anchor">#</a> Use the null condition operator: <code>?.</code> (available in C# 6 and VB.NET 14):</h4> <p>This is also sometimes called the safe navigation or Elvis (after its shape) operator. If the expression on the left side of the operator is null, then the right side will not be evaluated and null is returned instead. That means cases like this:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>var title <span class="token operator">=</span> person<span class="token punctuation">.</span>Title<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If the person does not have a title, this will throw an exception because it is trying to call <code>ToUpper</code> on a property with a null value.</p> <p>In C# 5 and below, this can be guarded with:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>var title <span class="token operator">=</span> person<span class="token punctuation">.</span>Title <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> person<span class="token punctuation">.</span>Title<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Now the title variable will be null instead of throwing an exception. C# 6 introduces a shorter syntax for this:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code>var title <span class="token operator">=</span> person<span class="token punctuation">.</span>Title<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This will result in the title variable being null, and the call to ToUpper is not made if <code>person.Title</code> is null.</p> <p>Of course, you <em>still</em> have to check <code>title</code> for null or use the null condition operator together with the null coalescing operator (<code>??</code>) to supply a default value:</p> <div class="language-c sharp line-numbers-mode"><pre class="language-c"><code><span class="token comment">// regular null check</span>
<span class="token keyword">int</span> titleLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>title <span class="token operator">!=</span> null<span class="token punctuation">)</span>
    titleLength <span class="token operator">=</span> title<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> <span class="token comment">// If title is null, this would throw NullReferenceException</span>

<span class="token comment">// combining the `?` and the `??` operator</span>
<span class="token keyword">int</span> titleLength <span class="token operator">=</span> title<span class="token operator">?</span><span class="token punctuation">.</span>Length <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div style="padding:0 1rem;" data-v-d5479672><div class="block" data-v-d5479672><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/" data-v-d5479672><img alt="知识共享许可协议" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAYAAABjyArgAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAdnJLH8AAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAABmtJREFUaN7tWltPG0cU5rkqiFdEpSBVrQCpFbRKX1olSOkPoE+tKqXiIU15K0qaqGmdQJCTKG0kZJFGoRLQFglVgWDA3HzBNtjGd68NIa888AMQv+BU36xnmF12vbvGNMhhpBHruZxlvjnznctsAxE1NTQ00HmtfSXCn/KP5cASrYZWyB9eo9BGkMKxMG0kohRLxWgrk6BULknpfJqyhQzllCzlijm1KlnKKhnK5NNsDMbGUzE2NxILM1n+sJ/Jxjt8a4u0sDpP88temlt6SS99s6zOLs7QzMKLuqkS0EfgBiJ+Wt8MUTQeoVhyk4GVzqcYgIVSnoo7CpVeFWl7d5t2XqsVz6VXJdaHMVkly+ZgLmREExEmE7L1IHuX5wTIALhOQW7QgpuIMg1MZpNMWwEaQHU/cNOVL69QY1PjsaOANvS5H7rZ2MJ2gW0KNDqejjNtXt9c14C8uLZA8yteFWTfEch3XHeoo6Pj2DvQhj67izsLcgTAoAUZXACTK2aZVnpGPdTa2mqbdzDW89TD5oJCoM0JAXJI0MWS30eLqyrI0OI/xp5Se0e7kNPT00MDAwOs4pm3Y8zo81HTRaHvrMgRAIMnQQtH4OaYJvZ+1asBr7m5mfr6+mhoaIgikQireEYb+uSxmBtPxihfUkGGJoMuVE5eo5XgsqCKf6b/pqamJnVeby/t7e2RvqANfRiDsUaLmpyaOFNyBMAwaOBL0AI0Vw8uwAOQBwcHVKlMTk5qgMbuAmRsGDYO74DhC0YDtLa+qlLF6oI4gtgouUjWWPMOLlu/IK5xejmekRH69utvTizHbM1mcgTAOL4wSuBcHG0Z3K6uLsMdNCvYBMyRNRkywcl4xxFVqFp8d9AlNOX17q4lwChcc2QOxDPaPunupj+fj2nAbWlpocZ3G+n2zZ9of3/flhyj/8esGMnRABxj1JBiBg2cK4NrpbV2QAYnw/AxqkjFKBJXtRhc3NGpaq+TTcRYbmj4YvgpaP/gQ3r/Qhtd/vwL6v/+OmvD6Xv08BF7np2ZsSXnpP+PBmCmvUqGUQM3aDjqiqJQtQUgc7qATMiGC8e1OLShajE3IPqC48k3yOiockMjLwZtt27cpJ9v3WYg88o110gjzeTIRZYl10pyNACDH/OlPHPF+KKw6yctnJ9Q4cLhhHAuDpfdNvTBMuuLQVSkKZijB0aWk0omGbCyDPzWg2wlB6X/h37DWkmOBmBEaMqOwnxZrr0yNcBbAM9gl1Bl8PV9IyMjmhdzLYZscDEiPpkmTgtgXqC5ALb7o4+F5sHgBfx+R3KsSkWAYdxwhHkQIR9JAGjk7wJMr9dr2CfP50cdshHxgYoSZZctGA3WnCLkcnh4SBPj4+wZmqs/4uDp/4UikE/Y3i2JBclayI1VW1sbI3MAjmccf97HPQ0AzvuMaAJhdU7Dw0Hq7Ow0NSpm2mvXOEFTAQS0F5XTBAzdvV9ddKH1PVtyrl+7ZlhtGzn4vsgr8AUBRP0ijTjZDl/LJwDvgE+8ldkSAA/evyfcIrsAW7lXMj247w8LNw0uG7TaqZwTu2lvEmAEHNxVsxNocK5zEiA8+e33Y4FGNXIqcW/FQMMuRcDwwXXDM0CVKULfZ5ciAPD0i+n6DpUrGblKhsyOkeM7rBq5InuXbOQA8FLAR1P/TmmyVtg0yMF8OWixStIAHDlJ8yblHHPTeIgM10p/zM3cNIDM2/V9KNBo2U1LS25aIBIQmTWWH16ao1/u1mG6kgcacpis92drGWhslgMNpC55Vo2nLevpdkMAnEgbh8pO4vFqQ2U5+V63AMvJnom/xmuf7Bn1MNlI9uBdPGUpJ975zUY9XR0JgFFdgy6Rrrz63VUNyE6SPtB6w3RlIUPDD4bfxtvlox8DN35kblSxioQ7+jBGTrhf/Owiowb42a5y3vetBhgVCXAEAwBZ1uRqrowAbr6Yo2djz+x+R2AYZOjH2JFj9tssmeRETqWklCXAAmRFvfQEJzu+9Bzll55Z2+AaAWG0MCcbVWm+3Y2qgRzjDtCFfG0P0Kyu7XFzwa7t8X1EIeOYFqzSlU43yuxvLeVUDTC73/q0m7yLXubCwU9WxIcnJenDkxJrkz88mfd56dLlS9V8anQiarCihGo0uAZyrP9hgPX4yWMKRUPSp1Plik+nChnWhzHVAHtaGnxmOfi81rAS0TvnQJze15X/AThizWB3h5mcAAAAAElFTkSuQmCC" style="border-width:0" data-v-d5479672></a> <br data-v-d5479672>本作品采用
    <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/" data-v-d5479672>
      知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议
    </a>
    进行许可。
  </div></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.68e77b21.js" defer></script><script src="/assets/js/3.fe1004ba.js" defer></script><script src="/assets/js/1.dbbc696f.js" defer></script><script src="/assets/js/25.b81b40e7.js" defer></script><script src="/assets/js/8.9bd2c16f.js" defer></script>
  </body>
</html>
